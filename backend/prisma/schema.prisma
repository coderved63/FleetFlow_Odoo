generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  FLEET_MANAGER
  DISPATCHER
  SAFETY_OFFICER
  FINANCIAL_ANALYST
}

enum VehicleType {
  TRUCK
  VAN
  BIKE
}

enum DriverStatus {
  ON_DUTY
  OFF_DUTY
  SUSPENDED
}

enum FleetStatus {
  IN_SHOP
  IN_USE
}

enum InUseVehicleStatus {
  IN_TRIP
  AVAILABLE
}

enum OnDutyStatus {
  IN_TRIP
  AVAILABLE
}

enum LoggedStatus {
  LOGGED
  NOT_LOGGED
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String
  role      Role     @default(FLEET_MANAGER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Vehicle {
  id              Int         @id @default(autoincrement())
  name            String
  licensePlate    String      @unique
  maxLoadCapacity Float       // in kg
  type            VehicleType @default(TRUCK)
  odometer        Float       @default(0)
  status          String      @default("Available") // Available, On Trip, In Shop, Out of Service
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  trips           Trip[]
  maintenanceLogs MaintenanceLog[]
  fuelLogs        FuelLog[]
}

model Driver {
  id            Int       @id @default(autoincrement())
  name          String
  licenseExpiry DateTime
  status        String    @default("On Duty") // On Duty, Off Duty, Suspended
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  license         License?
  trips           Trip[]
}

model Trip {
  id                      Int       @id @default(autoincrement())
  tripId                  String    @unique
  vehicle                 Vehicle   @relation(fields: [vehicleId], references: [id])
  vehicleId               Int
  driver                  Driver    @relation(fields: [driverId], references: [id])
  driverId                Int
  cargoWeight             Float     // in kg
  origin                  String
  destination             String
  estimatedDistance       Float     // in km
  estimatedFuelPricePerKm Float
  estimatedTripPrice      Float
  status                  String       @default("Draft") // Draft, Dispatched, Completed, Cancelled
  startDate               DateTime     @default(now())
  endDate                 DateTime?
  logged                  LoggedStatus @default(NOT_LOGGED)
  startOdometer           Float?
  endOdometer             Float?
  actualDistance          Float?
  actualFuelCost          Float?
  actualTripPrice         Float?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
}

model MaintenanceLog {
  id          Int      @id @default(autoincrement())
  vehicle     Vehicle  @relation(fields: [vehicleId], references: [id])
  vehicleId   Int
  serviceType String
  cost        Float
  date        DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model FuelLog {
  id        Int      @id @default(autoincrement())
  vehicle   Vehicle  @relation(fields: [vehicleId], references: [id])
  vehicleId Int
  liters    Float
  cost      Float
  date      DateTime @default(now())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model License {
  id          Int          @id @default(autoincrement())
  fullName    String
  licenseNo   String
  vehicleType VehicleType
  expiryDate  DateTime
  status      DriverStatus
  driver      Driver       @relation(fields: [driverId], references: [id])
  driverId    Int          @unique
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}
